# DigiLedger V0.3.4

DigiLedger æ˜¯ä¸€æ¬¾é¢å‘ä¸ªäººã€å®¶åº­ä¸å°å›¢é˜Ÿçš„æ•°ç ç‰©å“ï¼ˆåç«¯æ²¿ç”¨ `asset` å‘½åï¼‰å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿã€‚æœ¬ä»“åº“åŒ…å« **Spring Boot + MyBatis** å®ç°çš„åç«¯æœåŠ¡ä¸ **Vue 3 + Vite + Element Plus** å®ç°çš„å‰ç«¯ç•Œé¢ï¼Œå¹¶æä¾›ä¸€é”®å¯åŠ¨çš„ Docker Composeï¼ˆå« MinIOï¼‰ç¼–æ’ã€‚

## æ ¸å¿ƒç‰¹æ€§

- èµ„äº§æ€»è§ˆï¼šå…¨æ–°â€œèµ„äº§æ€»è§ˆâ€é¡µé¢å‘ˆç°åœ¨åº“/æ€»æ•°ã€æ€»æŠ•å…¥ä¸ 30 å¤©è¶‹åŠ¿ï¼Œå¹¶æä¾›æŒ‰ç±»åˆ«åˆ‡æ¢ä¸å¿«æ·åˆ›å»ºå…¥å£ã€‚
- ç‰©å“ä¸»æ¡£ï¼šè®°å½•è®¾å¤‡å“ç‰Œã€å‹å·ã€åºåˆ—å·ã€çŠ¶æ€ç­‰åŸºç¡€ä¿¡æ¯ï¼Œæ”¯æŒå¤šçº§ç±»åˆ«ã€æ ‡ç­¾ä¸å°é¢ä¸Šä¼ ã€‚
- å­—å…¸ä¸­å¿ƒï¼šç³»ç»Ÿè®¾ç½®é¡µé¢ç»Ÿä¸€ç»´æŠ¤ **ç‰©å“ç±»åˆ«ï¼ˆæ ‘å½¢ï¼‰**ã€**æ¥æº/å‡ºå”®å¹³å°** ä¸ **æ ‡ç­¾ï¼ˆæ ‘å½¢ + é¢œè‰²/å›¾æ ‡ï¼‰**ï¼Œå‰ç«¯è‡ªåŠ¨è”åŠ¨ã€‚
- è´­ä¹°è®°å½•ï¼šæ”¯æŒä¸»è´­ / é…ä»¶ / æœåŠ¡å¤šç±»æŠ•å…¥ï¼Œæ”¯æŒå¹³å°å­—å…¸é€‰æ‹©ï¼Œè‡ªåŠ¨æ±‡æ€»æŠ•å…¥ã€æ—¥å‡æˆæœ¬ä¸ä½¿ç”¨å¤©æ•°ã€‚
- å‡ºå”®å‘å¯¼ï¼šä¸€æ¬¡æ€§è®°å½•å”®å‡ºå¹³å°ã€ä»·æ ¼ã€è´¹ç”¨ä¸å‡€æ”¶å…¥ï¼Œå¹¶è”åŠ¨ç‰©å“çŠ¶æ€ã€‚
- å¿ƒæ„¿å•ï¼šç®¡ç†å¾…è´­è®¾å¤‡ï¼Œæ”¯æŒå›¾ç‰‡ã€æ ‡ç­¾ã€çŠ¶æ€ç­›é€‰ï¼Œå¯ä¸€é”®æ ‡è®°â€œå·²è´­ä¹°â€å¹¶è½¬ä¸ºç‰©å“ã€‚
- å¯¹è±¡å­˜å‚¨ï¼šæä¾› `/api/files/upload` æ¥å£æ¥å…¥ MinIOï¼Œç»Ÿä¸€è¿”å›ä½“ `{code,data,msg}`ã€‚
- å‰ç«¯ä¸­å°ï¼šä»ªè¡¨ç›˜ã€ç‰©å“åˆ—è¡¨ä¸å¿ƒæ„¿å•å‡å¯é€šè¿‡ Nginx åä»£è®¿é—® `/api`ã€‚

## ç›®å½•ç»“æ„

```
â”œâ”€â”€ backend/                 # Spring Boot åç«¯å·¥ç¨‹
â”‚   â”œâ”€â”€ src/main/java        # æ ¸å¿ƒä»£ç ï¼ˆæ§åˆ¶å™¨ã€æœåŠ¡ã€Mapperã€å®ä½“ï¼‰
â”‚   â”œâ”€â”€ src/main/resources   # MyBatis XMLã€é…ç½®æ–‡ä»¶ã€schema & seed SQL
â”‚   â”œâ”€â”€ src/test/java        # å•å…ƒæµ‹è¯•æ ·ä¾‹
â”‚   â””â”€â”€ Dockerfile           # åç«¯å®¹å™¨é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ frontend/                # Vue3 å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src                  # é¡µé¢ã€ç»„ä»¶ä¸ API å°è£…
â”‚   â”œâ”€â”€ public               # é™æ€èµ„æº
â”‚   â””â”€â”€ Dockerfile           # å‰ç«¯å®¹å™¨é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ deploy/nginx/nginx.conf  # Nginx åå‘ä»£ç†é…ç½®
â”œâ”€â”€ docker-compose.yml       # ä¸€é”®å¯åŠ¨ç¼–æ’ï¼ˆMySQL + MinIO + åç«¯ + å‰ç«¯ + Nginxï¼‰
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜
â””â”€â”€ è®¾è®¡æ–‡æ¡£.md               # ä¸šåŠ¡ä¸æ¶æ„è®¾è®¡è¯´æ˜
```

## åç«¯å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘

1. å®‰è£… JDK 17 ä¸ Mavenã€‚
2. å¯åŠ¨ MySQL 8ï¼Œå¹¶å¯¼å…¥ `backend/src/main/resources/sql/schema.sql` ä¸ `seed.sql`ã€‚
3. ä¿®æ”¹ `backend/src/main/resources/application.yml` ä¸­çš„æ•°æ®æºé…ç½®æˆ–é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ã€‚
4. åœ¨ `backend/` ç›®å½•è¿è¡Œï¼š

   ```bash
   mvn spring-boot:run
   ```

5. é»˜è®¤ç›‘å¬ç«¯å£ä¸º `http://localhost:8080`ï¼ŒREST æ¥å£è¿”å›ç»Ÿä¸€ç»“æ„ `{ code, data, msg }`ï¼Œé”™è¯¯ç å¯¹é½è®¾è®¡æ–‡æ¡£ 5.8ã€‚

### å•å…ƒæµ‹è¯•

```bash
cd backend
mvn test
```

## å‰ç«¯å¿«é€Ÿå¼€å§‹

1. å®‰è£… Node.js 18+ ä¸ npmã€‚
2. åœ¨ `frontend/` ç›®å½•è¿è¡Œï¼š

   ```bash
   npm install
   npm run dev
   ```

3. Vite å¼€å‘æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `http://localhost:5173`ï¼Œä¼šé€šè¿‡ä»£ç†å°† `/api` è¯·æ±‚è½¬å‘è‡³ `http://localhost:8080`ã€‚

4. ç”Ÿäº§æ„å»ºï¼š

```bash
npm run build
npm run preview
```

å‰ç«¯æä¾›èµ„äº§æ€»è§ˆã€ç‰©å“ä¸­å¿ƒï¼ˆå«æ–°å¢/ç¼–è¾‘/å‡ºå”®å‘å¯¼ã€å¡ç‰‡è§†å›¾ã€æ‰¹é‡æ ‡ç­¾ï¼‰ä¸å¿ƒæ„¿å•ç®¡ç†é¡µé¢ï¼Œå‡å·²æ¥å…¥ç»Ÿä¸€ API ä¸ç³»ç»Ÿå­—å…¸ã€‚

> ğŸ“¸ å‰ç«¯æ–°ç•Œé¢æˆªå›¾å ä½ï¼šè¯·åœ¨å®é™…éƒ¨ç½²åè¡¥å……æœ€æ–°æˆªå›¾ã€‚

## API & è°ƒè¯•å·¥å…·

- OpenAPI è§„èŒƒï¼š`deploy/openapi.yaml`
- Postman é›†åˆï¼š`deploy/postman/DigiLedger.postman_collection.json`ï¼ˆè¦†ç›–å­—å…¸ã€ç‰©å“åˆ›å»º/æŸ¥è¯¢ç­‰æ ¸å¿ƒæµç¨‹ï¼‰

## Docker éƒ¨ç½²

### ä¸€ä½“åŒ–å¯åŠ¨

ä»“åº“æ ¹ç›®å½•æä¾› `docker-compose.yml`ï¼ŒåŒ…å«ä»¥ä¸‹æœåŠ¡ï¼š

- `mysql`ï¼šMySQL 8.3ï¼Œè‡ªåŠ¨æŒ‚è½½ schema ä¸ç§å­æ•°æ®ã€‚
- `minio`ï¼šå¯¹è±¡å­˜å‚¨ï¼Œç«¯å£ `9000/9001`ï¼Œç”¨äºç‰©å“å°é¢åŠé™„ä»¶ä¸Šä¼ ã€‚
- `backend`ï¼šSpring Boot åº”ç”¨ï¼Œè¯»å–ç¯å¢ƒå˜é‡è¿æ¥æ•°æ®åº“ã€‚
- `frontend`ï¼šVue ç¼–è¯‘äº§ç‰©ï¼Œé€šè¿‡ `npx serve` è¾“å‡ºé™æ€é¡µé¢ã€‚
- `nginx`ï¼šç»Ÿä¸€æš´éœ² 80 ç«¯å£ï¼Œ`/api` åå‘ä»£ç†è‡³åç«¯ï¼Œ`/` è½¬å‘åˆ°å‰ç«¯ã€‚

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å®Œæˆä¸€ä½“åŒ–å¯åŠ¨ï¼š

```bash
docker compose up --build -d
```

å¯åŠ¨å®Œæˆåè®¿é—® `http://localhost` å³å¯æµè§ˆå‰ç«¯é¡µé¢ï¼Œåç«¯æ¥å£é€šè¿‡ `http://localhost/api` è®¿é—®ï¼›MinIO æ§åˆ¶å°ä½äº `http://localhost:9001`ã€‚

### å•ç‹¬éƒ¨ç½²åç«¯

```bash
cd backend
docker build -t digiledger-backend:latest .
docker run -d --name digiledger-backend \
  -e DL_DB_HOST=<mysql-host> \
  -e DL_DB_PORT=3306 \
  -e DL_DB_NAME=digiledger \
  -e DL_DB_USER=root \
  -e DL_DB_PASS=root \
  -p 8080:8080 \
  digiledger-backend:latest
```

### å•ç‹¬éƒ¨ç½²å‰ç«¯

```bash
cd frontend
docker build -t digiledger-frontend:latest .
docker run -d --name digiledger-frontend \
  -e VITE_API_BASE=/api \
  -p 4173:4173 \
  digiledger-frontend:latest
```

å¯æ­é…ä»»æ„ Nginx/Traefik ä»£ç†å°† `/api` æŒ‡å‘åç«¯æœåŠ¡ã€‚

## ç¯å¢ƒå˜é‡ä¸€è§ˆ

| å˜é‡å                | é»˜è®¤å€¼        | è¯´æ˜                           |
|-----------------------|---------------|--------------------------------|
| `DL_DB_HOST`          | mysql         | åç«¯è¿æ¥çš„ MySQL ä¸»æœº          |
| `DL_DB_PORT`          | 3306          | åç«¯è¿æ¥çš„ MySQL ç«¯å£          |
| `DL_DB_NAME`          | digiledger    | æ•°æ®åº“åç§°                     |
| `DL_DB_USER`          | root          | æ•°æ®åº“ç”¨æˆ·å                   |
| `DL_DB_PASS`          | root          | æ•°æ®åº“å¯†ç                      |
| `DL_SERVER_PORT`      | 8080          | Spring Boot æœåŠ¡ç«¯å£           |
| `DL_STORAGE_PROVIDER` | minio         | å¯¹è±¡å­˜å‚¨æä¾›æ–¹                 |
| `DL_STORAGE_ENDPOINT` | http://minio:9000 | å¯¹è±¡å­˜å‚¨å†…éƒ¨è®¿é—®åœ°å€      |
| `DL_STORAGE_BUCKET`   | digiledger    | ä¸Šä¼ ä½¿ç”¨çš„æ¡¶åç§°               |
| `DL_STORAGE_ACCESS_KEY` | minioadmin  | å­˜å‚¨ AccessKey                |
| `DL_STORAGE_SECRET_KEY` | minioadmin  | å­˜å‚¨ SecretKey                |
| `DL_STORAGE_BASE_URL` | http://localhost:9000 | æ–‡ä»¶è®¿é—®åŸºç¡€ URL   |
| `VITE_API_BASE`       | /api          | å‰ç«¯è®¿é—®åç«¯çš„åŸºç¡€è·¯å¾„         |

## ä¸‹ä¸€æ­¥è®¡åˆ’

- è¡¥å……è®¤è¯æˆæƒã€å¤šç”¨æˆ·æƒé™æ¨¡å‹ã€‚
- å¢å¼ºå¯¼å…¥å¯¼å‡ºèƒ½åŠ›ï¼Œæ”¯æŒå¸¸è§ç”µå•†è´¦å•ã€‚
- æ„å»ºç»Ÿè®¡æŠ¥è¡¨ä¸ä»ªè¡¨ç›˜ï¼Œæ”¯æŒå¤šç»´åˆ†æã€‚

æ›´å¤šä¸šåŠ¡ç»†èŠ‚åŠé”™è¯¯ç å®šä¹‰å¯å‚è€ƒ `è®¾è®¡æ–‡æ¡£.md` ä¸ `deploy/openapi.yaml`ã€‚
